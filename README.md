Пайплайн работы:
Пользователь заходит на сайт.
Может придти сам, может по рефералке.
Если по рефералке, нужно установить куки с id пригласившего.
Приходит пользователь, выбирает бесплатная или платная подписка?
Если бесплатная, то генерим uuid, он должен привязать свой тг в боте. Как только сделал, подписка оформляется на 3 дня.
Если платная подписка, юзер сначала оплачивает, потом мы создаем для него ключ и отдаем его. 

Бесплатная подписка:
Создать uuid 
Сразу отдать ссылку на подписку
Юзер идет в тг бот
Вставляет подписку
Проверяем, что этот юзер не юзал пробный период
Добавляем на все сервера
Сообщаем ему о доступности всех серверов 


Платная подписка:
Прилетает запрос на платеж. Тут указана сумма платежа, какая-то мета информация о подписке, типа срока действия подписки на впн. Тут же можем сгенерировать UUID и передать как ключ идемпотентности(если такое доступно) и сгенерировать подписку на vpn, чтобы потом, в случае успешной оплаты, добавить его на все сервера-агенты
Записываем в базу 
Юзер оплатил его
Получаем оповещение 
Записываем рефереру 25% от платежа, если он есть
Юзаем прошлый UUID и добавляем его на все серверы 
Мы не собираем никаких данных от юзера и его идентификатором является именно UUID, который мы генерируем и везде сопоставляем. То есть для нас один конкретный юзер - только UUID

Информация о юзере, которая поступает с клиента:

